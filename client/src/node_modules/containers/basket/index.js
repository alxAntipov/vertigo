import './basket.css'

import * as R from 'ramda';
import React from 'react';
import {connect} from 'react-redux'
import Header from 'components/header';
import Footer from 'components/footer';
import {Link} from 'react-router'
import { getBasketWithCount, getTotalBasketPrice } from 'selectors';
import {
    removeComicsFromBasket,
    basketCheckout,
    cleanBasket
} from 'actions'
const Basket = ({
        comics, 
        totalPrice, 
        removeComicsFromBasket,
        cleanBasket,
        basketCheckout
    }) => {
    const isBasketEmpty = R.isEmpty(comics)

    const renderContent = () => {
        return (
            <div>
                {isBasketEmpty && <div className="basket-table__empty" >Корзина пуста </div>}

                <div className="basket-table">
                    <table className="table">
                        <tbody>
                            {!isBasketEmpty &&
                                <tr>
                                    <td >&nbsp;</td>
                                    <td className='basket-table__item'>Название</td>
                                    <td className='basket-table__item'>Стоимость</td>
                                    <td className='basket-table__item'>Количество</td>
                                    <td className='basket-table__item'>Удалить</td>
                                </tr>
                            }
                            {comics.map((comicsBook, index) =>
                                <tr
                                        key={index }
                                        className='basket-table__item-checout'
                                    >
                                    <td className='first-column-checkout'>
                                    {<img
                                        className='basket-table__img'
                                        src={comicsBook.image}
                                        alt={comicsBook.name}
                                    />}
                                    </td>
                                    <td className='basket-table__item'>{comicsBook.name}</td>
                                    <td className='basket-table__item'>{comicsBook.price*comicsBook.count}$</td>
                                    <td className='basket-table__item'>{comicsBook.count}</td>
                                    <td className='basket-table__item'>
                                        <img
                                            onClick={() => removeComicsFromBasket(comicsBook.id)}
                                            className='basket-table__delete-cart'
                                            src="/icons/delete.png"
                                            alt={comicsBook.name}
                                        />
                                    </td>
                                </tr>
                            )}
                        </tbody>
                    </table>
                </div>
                {
                    R.not(isBasketEmpty) &&
                    <div className='basket__total'>
                        <b>Итого: </b>
                        {totalPrice}$
                    </div>
                }
            </div>
        )
    }
    
    const renderSidebar = () => {
        return (
            <div>
                <Link
                    to={`/`}
                    className='basket__btn basket__btn-continue'
                >
                    Продолжить
                </Link>
                {
                    R.not(isBasketEmpty) &&
                    <div>
                        <button 
                            onClick={cleanBasket}
                            className="basket__btn basket__btn-clean"
                        >
                            Очистить корзину
                        </button>
                        <button 
                            onClick={() => basketCheckout(comics)}
                            className="basket__btn basket__btn-buy"
                        >
                            Оформить заказ
                        </button>
                    </div>
                }
            </div>
        )
    }
    return (
    <div>
        <Header/>
        <div className = "content">
            <div className="basket-container">
                {renderContent()}
            </div>
            <div className="basket-sidebar">
                {renderSidebar()}
            </div>
        </div>
        <Footer/>
    </div>
    )
}

const mapStateToProps = state => ({
   comics: getBasketWithCount(state),
   totalPrice: getTotalBasketPrice(state)
})

const mapDispatchToProps = {
    removeComicsFromBasket,
    cleanBasket,
    basketCheckout
}

export default connect(mapStateToProps, mapDispatchToProps)(Basket)